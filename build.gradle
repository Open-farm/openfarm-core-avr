apply from: 'util.gradle'
apply from: 'properties.gradle'

// This task simply runs everything.
task build(dependsOn:'gendocs') {
	//
}

// This task generates documentation.
task gendocs(dependsOn:'buildlibs') {
	doLast {
		exec_cmd([
			'doxygen',
			'.doxygen.config'])
	}
}

// This task build libs to static libraries.
task buildlibs {
	doLast { task ->
		def libs = new File('libs')
		if (!libs.exists())
		{
			libs.create()
		}

		def thirdPartyDir = new File('thirdparty')
		def baseCoreDir = new File('.')

		exec_cmd([
			'make',
			"ARDUINODIR=$arduinoDir",
			"BASECOREDIR=${baseCoreDir.getAbsolutePath()}",
			"THIRDPARTYDIR=${thirdPartyDir.getAbsolutePath()}",
			"CC=$cc",
			"ARCHIVER=$archiver",
			"CPUNAME=$cpuName",
			"CPUCLOCK=$cpuClock",
			"COREINC=-I$coreInc",
			"VARIANTINC=-I$arduinoVariant"])
	}
}

// Cleans lib + generated folders.
task clean {
	doLast {
		exec_cmd(['rm', '-rf', 'libs'])
		exec_cmd(['rm', '-rf', 'docs/generated/html'])
	}
}